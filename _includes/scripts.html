<script src="assets/js/main.min.js"></script>

{% include analytics.html %}
{% include fetch_gscholar_stats.html %}


<script xml:space="preserve" language="JavaScript">
hideallbibs();
hideallabs();
</script>

<script>
	var showcontent = false

    function expandContent() {
        var content = document.querySelector('.content');
        if (!content.classList.contains('expand')) {
            content.classList.add('expand');
            var btn = document.querySelector('.more-btn');
            btn.textContent = 'View Less';

            var btn = document.querySelector('.more-btn');
            btn.style.display = 'none';
        }
    }

    function toggleContent() {
		if (!showcontent){
        var content = document.querySelector('.content');
        content.classList.toggle('expand');
        var btn = document.querySelector('.more-btn');
        btn.textContent = content.classList.contains('expand') ? 'View Less' : 'View More';
        showcontent = true

        if (content.classList.contains('expand')) {
            var btn = document.querySelector('.more-btn');
            btn.style.display = 'none';
        }
        }
    }

    function handleLinkClick(e) {
        e.stopPropagation();
    }

    document.addEventListener('DOMContentLoaded', function() {
        var content = document.querySelector('.content');
        var tooltip = document.querySelector('.tooltip');

        content.addEventListener('mousemove', function(event) {
            var mouseX = event.clientX;
            var mouseY = event.clientY;
            var tooltipWidth = tooltip.offsetWidth;
            var tooltipHeight = tooltip.offsetHeight;

            var contentWidth = content.offsetWidth;
            var contentHeight = content.offsetHeight;
            
            tooltip.style.left = (mouseX -contentWidth/2) + 'px';
            tooltip.style.top = (mouseY-contentHeight/2) + 'px';
        });

        var links = content.querySelectorAll('a');
        
        links.forEach(function(link) {
            link.addEventListener('click', handleLinkClick);
        });
    }
    );

</script>


<!-- Show more content -->
<script>
    function toggle_vis(id) {
        // var e = document.getElementById(id);
        var e = document.getElementsByClassName(id);
        var showText = document.getElementById("showText");
        for (var i = 0; i < e.length; i++) {
            if (e[i].style.display == "none") {
                e[i].style.display = "inline";
                showText.innerHTML = "[Show less]";
            } else {
                e[i].style.display = "none";
                showText.innerHTML = "[Show more]";
            }
        }
    }

    function suppressAutoHighlight(ms) {
        window.__tab_user_select_until = Date.now() + ms;
    }

    function setActiveResearchTab(tabElement) {
        var tabs = document.querySelectorAll('#research-tab-container .highlight_research_tab, #research-tab-container .research_tab');
        tabs.forEach(function(el) { el.className = 'research_tab'; });
        if (tabElement) {
            tabElement.className = 'highlight_research_tab';
        }
    }

    function getStickyTopPx() {
        try {
            var v = getComputedStyle(document.documentElement).getPropertyValue('--sticky-top');
            var n = parseInt(v, 10);
            return isNaN(n) ? 80 : Math.max(0, n);
        } catch (e) {
            return 80;
        }
    }

    function scrollToTargetProperly(selector) {
        var target = null;
        try {
            target = document.querySelector(selector);
        } catch (e) {
            target = null;
        }
        // If we matched a non-heading anchor (e.g., span.anchor), try the corresponding H2 explicitly.
        if (target && target.tagName !== 'H2') {
            var headingTarget = null;
            try {
                headingTarget = document.querySelector('h2' + selector);
            } catch (e2) {
                headingTarget = null;
            }
            if (headingTarget) {
                target = headingTarget;
            }
        }
        if (!target) return false;
        var sticky = getStickyTopPx();
        var rect = target.getBoundingClientRect();
        var y = window.pageYOffset + rect.top - sticky;
        window.scrollTo({ top: y, behavior: 'smooth' });
        return true;
    }

    function toggle_research_vis(target, tabElement) {
        var is_current_summary = 0;

        function updateCurrentActiveIndex() {
            if (!tabElement) return;
            var idx = -1;
            if (tabElement === tab_a) {
                idx = 0;
            } else if (tabElement === tab_b) {
                idx = 1;
            } else if (tabElement === tab_c) {
                idx = 2;
            } else if (tabElement === tab_d) {
                idx = 3;
            }
            if (idx >= 0) {
                window.__current_active_idx = idx;
            }
        }

        if (target && target !== "") {
            setActiveResearchTab(tabElement);
            suppressAutoHighlight(1200);
            updateCurrentActiveIndex();
            if (!scrollToTargetProperly(target)) {
                try {
                    window.location.hash = target.replace('#', '');
                } catch (e) {}
            }
        } else {
            setActiveResearchTab(tabElement);
            suppressAutoHighlight(1200);
            updateCurrentActiveIndex();
        }
    }

</script>

<script>
window.onscroll = function() {scrollFunction()};
 
function scrollFunction() {console.log(121);

    if (window.screen.width < 500) {
        var length = 5000
    } else {
        var length = 2000
    }

    if (document.body.scrollTop > length || document.documentElement.scrollTop > length) {
        document.getElementById("toTopBtn").style.display = "block";
    } else {
        document.getElementById("toTopBtn").style.display = "none";
    }
}
 
function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}

function setHeight() {
  let vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}

if (window.screen.width < 500) {
	window.addEventListener('resize', setHeight);
	setHeight();
}

</script>

<script>
	var tab_a = document.getElementById('tab_a');
	var tab_b = document.getElementById('tab_b');
	var tab_c = document.getElementById('tab_c');
	var tab_d = document.getElementById('tab_d');

    const buttonContainer = document.getElementById('research-tab-container');
    const placeholder = document.getElementById('all_tab_place');
    var content = document.querySelector('#view-topic .content');

    const tab_b_placeholder = document.getElementById('tab_b_place');
    const tab_c_placeholder = document.getElementById('tab_c_place');
    const tab_d_placeholder = document.getElementById('tab_d_place');
    const end_placeholder = document.getElementById('end_place');

    if (buttonContainer && placeholder && content && tab_a && tab_b && tab_c && tab_d && tab_b_placeholder && tab_c_placeholder && tab_d_placeholder && end_placeholder) {
        const buttonOffsetTop = buttonContainer.offsetTop;

        function updateSticky(scrollTop) {
            if (scrollTop >= buttonOffsetTop) {
                var height = buttonContainer.offsetHeight;
                placeholder.style.height = height + 'px';

                if (window.screen.width < 1024) {
                    buttonContainer.classList.add('sticky_mobile');
                    buttonContainer.classList.remove('sticky');
                } else {
                    buttonContainer.classList.add('sticky');
                    buttonContainer.classList.remove('sticky_mobile');
                }
            } else {
                placeholder.style.height = '0px';
                buttonContainer.classList.remove('sticky');
                buttonContainer.classList.remove('sticky_mobile');
            }
        }

        function updateActiveTab() {
            if (window.__tab_user_select_until && Date.now() < window.__tab_user_select_until) {
                return;
            }
            var sticky = getStickyTopPx();
            var headings = [
                document.querySelector('h2#-motion-capture'),
                document.querySelector('h2#-motion-understanding'),
                document.querySelector('h2#-human-reconstruction'),
                document.querySelector('h2#-animatable-avatar')
            ];
            var tabs = [tab_a, tab_b, tab_c, tab_d];
            var candidateIdx = 0;
            for (var i = 0; i < headings.length; i++) {
                var h = headings[i];
                if (!h) {
                    continue;
                }
                var top = h.getBoundingClientRect().top;
                if (top - sticky <= 8) {
                    candidateIdx = i;
                } else {
                    break;
                }
            }
            if (typeof window.__current_active_idx !== 'number') {
                window.__current_active_idx = candidateIdx;
                setActiveResearchTab(tabs[candidateIdx]);
                return;
            }
            if (candidateIdx !== window.__current_active_idx) {
                var delta = headings[candidateIdx] ? headings[candidateIdx].getBoundingClientRect().top - sticky : 0;
                if (Math.abs(delta) > 24) {
                    window.__current_active_idx = candidateIdx;
                    setActiveResearchTab(tabs[candidateIdx]);
                }
            }
        }

        function onScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
            updateSticky(scrollTop);
            updateActiveTab();
        }

        window.addEventListener('scroll', onScroll);
        window.addEventListener('resize', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
            updateSticky(scrollTop);
        });
    }
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    function updateStickyTopOffset() {
        var root = document.documentElement;
        if (!root) return;
        var defaultOffset = 80;
        var masthead = document.querySelector('.masthead');
        var offset = defaultOffset;
        if (masthead && masthead.offsetHeight) {
            offset = masthead.offsetHeight + 8;
        }
        root.style.setProperty('--sticky-top', offset + 'px');
    }

    updateStickyTopOffset();
    window.addEventListener('resize', updateStickyTopOffset);
});
</script>
